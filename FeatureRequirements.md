# 상세 기능 요구사항 (Feature Requirements)

## 목표 / 범위
- **오답노트**: 틀린 문제를 자동으로 저장하고 재학습할 수 있는 기능
- **즐겨찾기**: 사용자가 중요하다고 생각하는 문제를 별도로 관리하는 기능
- **문제 신고**: 문제의 오류(오타, 오답 등)를 사용자가 신고하고 관리자가 처리하는 기능
- **통계**: 서비스 운영 및 사용자 학습 상태를 파악하기 위한 데이터 집계 기능

## 개발 순서 (목표)
1. **오답노트 & 즐겨찾기 (CUD)**
   - 이유: 사용자의 학습 데이터가 쌓이는 핵심 기능이며, 퀴즈 제출 로직과 밀접하게 연관됨.
2. **문제 신고 (C)**
   - 이유: 데이터의 무결성을 위해 사용자 피드백을 받는 창구가 필요함.
3. **통계 (R/Aggregate)**
   - 이유: 축적된 데이터를 바탕으로 집계가 이루어지므로 가장 마지막에 구현.
4. **관리자 기능 (Admin)**
   - 이유: 신고 처리 및 전체 통계 확인을 위한 관리 도구 구축.

## 구현 체크리스트

### 1. 오답노트 (Wrong Answer Note)
- [ ] **quizwr-01**: 틀린 문제 자동 저장 (Upsert 로직) - 진행중(Upsert 구현 완료, 퀴즈 제출 흐름 자동 연동 미완료)
- [ ] **quizwr-02**: 오답 목록 조회 (필터링 및 페이징) - 진행중(페이징 구현 완료, 필터링 미완료)
- [ ] **quizwr-03**: 오답 재학습 세트 생성 (10문제 고정, 부족분 랜덤 채움)
- [ ] **quizwr-04**: 재학습 정답 시 오답노트에서 자동 제거

### 2. 즐겨찾기 (Favorites)
- [x] **quizfav-01**: 중요 문제 등록 (중복 방지 제약)
- [ ] **quizfav-02**: 즐겨찾기 목록 조회 (카테고리 필터링)
- [ ] **quizfav-03**: 즐겨찾기 해제 (토글 방식) - 진행중(해제 API 구현 완료, 단일 토글 API 미적용)

### 3. 문제 신고 (Problem Report)
- [ ] **quizrep-01**: 오류 신고 제출 (회원/게스트 구분)
- [ ] **quizrep-02**: [관리자] 신고 목록 조회 (상태별 필터링)
- [ ] **quizrep-03**: [관리자] 신고 처리 (상태 변경 및 문제 비활성화)

### 4. 통계 (Statistics)
- [ ] **quizstat-01**: 카테고리별 정답률 (latest/first 기준)
- [ ] **quizstat-02**: 문제별 정답률 및 난이도 지표
- [ ] **quizstat-03**: 가장 많이 틀린 TOP N 추출
- [ ] **quizstat-04**: 유저별 학습량 랭킹
- [ ] **quizstat-05**: 서비스 지표 (DAU, 완료율, 전환율)
- [ ] **quizstat-06**: [마이페이지] 개인 학습 통계 조회

## DB 매핑 메모
- `wrong_answers`: `member_id`, `question_id` (Unique), `wrong_count`, `last_wrong_at`
- `favorites`: `member_id`, `question_id` (Unique), `created_at`
- `problem_reports`: `question_id`, `reporter_id`, `report_type`, `status`, `action`
- `attempt_answers`: 통계 집계의 기준이 되는 원천 데이터 테이블

## 결정사항
- **통계 기준**: 난이도 측정은 '첫 제출(first)'을 기준으로, 성취도 측정은 '최신 제출(latest)'을 기준으로 함.
- **오답노트 제거**: 재학습 세트뿐만 아니라 일반 퀴즈에서도 해당 문제를 맞히면 오답노트에서 삭제함.

## 이슈 / 배운 점
- (구현 진행 시 기록 예정)

## 진행상황 브리핑 (2026-02-15 기준)

### 1) 오답노트
- **quizwr-01 (틀린 문제 자동 저장 / Upsert)**: `진행중`
  - 현재: `WrongAnswerCommandService`에 Upsert 로직 구현됨.
  - 미완료: 퀴즈 제출 흐름에서 자동 저장 연동이 아직 없음(현재는 수동 저장 API 중심).
- **quizwr-02 (오답 목록 조회 / 필터+페이징)**: `진행중`
  - 현재: 페이징 목록 조회 구현됨.
  - 미완료: 필터링(카테고리/조건) 미구현.
- **quizwr-03 (재학습 세트 10문제 생성)**: `미착수`
- **quizwr-04 (정답 시 오답노트 자동 제거)**: `미착수`
  - 참고: 수동 삭제 API는 존재하나, "정답 시 자동 제거" 비즈니스 연동은 미구현.

### 2) 즐겨찾기
- **quizfav-01 (등록 + 중복 방지 제약)**: `완료`
  - 현재: `FavoriteCommandService.saveFavorite` 구현됨.
  - 현재: `favorites(member_id, question_id)` 유니크 제약으로 중복 저장 방지됨.
- **quizfav-02 (목록 조회 + 카테고리 필터링)**: `미착수`
- **quizfav-03 (해제 + 토글 방식)**: `진행중`
  - 현재: `DELETE /api/favorites/{questionId}` 해제 API 구현됨.
  - 미완료: 단일 토글 API 설계/적용 및 목록 조회 기반 상태 연동.

### 3) 문제 신고
- **quizrep-01**: `미착수`
- **quizrep-02**: `미착수`
- **quizrep-03**: `미착수`

### 4) 통계
- **quizstat-01**: `미착수`
- **quizstat-02**: `미착수`
- **quizstat-03**: `미착수`
- **quizstat-04**: `미착수`
- **quizstat-05**: `미착수`
- **quizstat-06**: `미착수`

## 다음 한 단계 (Step 1)
- 목표: **오답노트/즐겨찾기를 "실사용 가능한 최소 단위"로 전환**
- 작업 범위:
  1. `quizwr-01` 마무리: 퀴즈 제출/채점 로직과 오답 Upsert 자동 연동
  2. `quizwr-02` 보강: 오답 목록 조회 필터 1종 이상 추가
  3. `quizfav-02` 착수: 즐겨찾기 목록 조회 API + 기본 페이징 구현
  4. 인증 연동: `X-Member-Id` 임시 헤더 제거, 인증 사용자 주입으로 전환
- 완료 기준:
  - 수동 호출 없이 오답 저장/삭제가 채점 결과에 따라 자동 반영
  - 오답/즐겨찾기 목록 조회 API가 모두 동작
  - 하드코딩 사용자 식별 없이 요청 사용자 기준으로 동작
